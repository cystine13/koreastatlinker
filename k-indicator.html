<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korea Indicator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 2px solid #ccc;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background-color: #f9f9f9;
            border-radius: 4px 4px 0 0;
            font-size: 16px;
        }

        .tab.active {
            background-color: white;
            font-weight: bold;
            border: 2px solid #ccc;
            border-bottom: none;
        }

        .filters {
            margin-bottom: 20px;
        }

        .filters label {
            margin-right: 10px;
        }

        .filters select {
            padding: 5px;
            font-size: 16px;
        }

        .statistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .statistics-table th,
        .statistics-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .statistics-table th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Korea Indicator</h1>
        </div>

        <div class="tabs" id="tabs">
            <!-- Tabs for categories will be dynamically generated -->
        </div>

        <div class="filters">
            <label for="year-range">Year:</label>
            <select id="start-year"></select>
            <span>~</span>
            <select id="end-year"></select>
        </div>

        <table class="statistics-table">
            <thead>
                <tr id="table-header">
                    <th>Year</th>
                </tr>
            </thead>
            <tbody id="statistics-body">
            </tbody>
        </table>
    </div>

    <script>
        fetch("population_data.json")
            .then(response => response.json())
            .then(data => {
                const years = Object.keys(data).sort((a, b) => b - a); // Sort years in descending order
                const startYearSelect = document.getElementById("start-year");
                const endYearSelect = document.getElementById("end-year");
                const tableHeader = document.getElementById("table-header");
                const tableBody = document.getElementById("statistics-body");
                const tabs = document.getElementById("tabs");

                // Populate year dropdowns
                years.forEach(year => {
                    const startOption = document.createElement("option");
                    const endOption = document.createElement("option");
                    startOption.value = endOption.value = year;
                    startOption.textContent = endOption.textContent = year;

                    startYearSelect.appendChild(startOption);
                    endYearSelect.appendChild(endOption);
                });

                startYearSelect.value = years[years.length - 1];
                endYearSelect.value = years[0];

                // Extract categories
                const categories = [...new Set(
                    Object.values(data).flatMap(yearData =>
                        Object.values(yearData).map(item => item.category_en)
                    )
                )];

                // Create tabs
                categories.forEach(category => {
                    const tab = document.createElement("div");
                    tab.textContent = category;
                    tab.className = "tab";
                    tab.dataset.category = category;

                    tab.addEventListener("click", () => {
                        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
                        tab.classList.add("active");
                        updateTable(category);
                    });

                    tabs.appendChild(tab);
                });

                // Set the first tab as active
                tabs.firstChild.classList.add("active");

                // Update table based on selected filters
                function updateTable(selectedCategory) {
                    const startYear = parseInt(startYearSelect.value);
                    const endYear = parseInt(endYearSelect.value);

                    tableHeader.innerHTML = "<th>Year</th>";
                    tableBody.innerHTML = "";

                    // Get items for the selected category
                    const items = Object.values(data)
                        .flatMap(yearData =>
                            Object.keys(yearData).filter(item => yearData[item].category_en === selectedCategory)
                        );

                    items.forEach(item => {
                        const th = document.createElement("th");
                        th.textContent = item;
                        tableHeader.appendChild(th);
                    });

                    years
                        .filter(year => year >= startYear && year <= endYear)
                        .forEach(year => {
                            const row = document.createElement("tr");
                            const yearCell = document.createElement("td");
                            yearCell.textContent = year;
                            row.appendChild(yearCell);

                            items.forEach(item => {
                                const cell = document.createElement("td");
                                const value = data[year][item]?.value || "-";
                                cell.textContent = value;
                                row.appendChild(cell);
                            });

                            tableBody.appendChild(row);
                        });
                }

                // Initialize table
                updateTable(categories[0]);

                // Update table when year range changes
                startYearSelect.addEventListener("change", () => {
                    const activeCategory = document.querySelector(".tab.active").dataset.category;
                    updateTable(activeCategory);
                });

                endYearSelect.addEventListener("change", () => {
                    const activeCategory = document.querySelector(".tab.active").dataset.category;
                    updateTable(activeCategory);
                });
            })
            .catch(error => console.error("Error loading data:", error));
    </script>
</body>
</html>
