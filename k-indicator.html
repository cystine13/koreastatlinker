<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korea Indicator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        /* 페이지 전체 컨테이너 */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* 탭 스타일 */
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            border-bottom: 2px solid #ccc;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background-color: #f9f9f9;
            border-radius: 4px 4px 0 0;
            font-size: 16px;
        }

        .tab.active {
            background-color: white;
            font-weight: bold;
            border: 2px solid #ccc;
            border-bottom: none;
        }

        /* 필터 영역 */
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .filters select {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* 테이블 스타일 */
        .statistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .statistics-table th,
        .statistics-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .statistics-table th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <!-- 헤더 동적 로드 -->
    <div id="header"></div>

    <div class="container">
        <div class="tabs" id="tabs">
            <!-- 카테고리 탭 동적 생성 -->
        </div>

        <div class="filters" id="filters">
            <!-- 연도 및 항목 필터 동적 생성 -->
        </div>

        <table class="statistics-table">
            <thead>
                <tr id="table-header">
                    <th>Year</th>
                </tr>
            </thead>
            <tbody id="statistics-body">
            </tbody>
        </table>
    </div>

    <script>
        // 헤더 동적 로드
        fetch("header.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("header").innerHTML = data;
            })
            .catch(error => console.error("Error loading header:", error));

        // JSON 데이터 로드 및 테이블 업데이트
        fetch("population_data.json")
            .then(response => response.json())
            .then(data => {
                const years = Object.keys(data).sort((a, b) => a - b); // 연도 정렬
                const tableHeader = document.getElementById("table-header");
                const tableBody = document.getElementById("statistics-body");
                const tabs = document.getElementById("tabs");
                const filters = document.getElementById("filters");

                // 카테고리 리스트 가져오기
                const categories = [...new Set(
                    Object.values(data).flatMap(yearData =>
                        Object.values(yearData).map(item => item.category_en)
                    )
                )];

                // 카테고리별 아이템 저장
                const categoryItems = {};
                Object.values(data).forEach(yearData => {
                    Object.entries(yearData).forEach(([itemName, itemData]) => {
                        const category = itemData.category_en;
                        if (!categoryItems[category]) {
                            categoryItems[category] = new Set();
                        }
                        categoryItems[category].add(itemName);
                    });
                });

                // 탭 생성
                categories.forEach(category => {
                    const tab = document.createElement("div");
                    tab.textContent = category;
                    tab.className = "tab";
                    tab.dataset.category = category;

                    tab.addEventListener("click", () => {
                        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
                        tab.classList.add("active");
                        updateFilters(category);
                        updateTable(category, [], years[0], years[years.length - 1]);
                    });

                    tabs.appendChild(tab);
                });

                tabs.firstChild.classList.add("active"); // 첫 번째 탭 기본 선택

                // 필터 업데이트
                function updateFilters(category) {
                    filters.innerHTML = "";

                    // 연도 선택 필터
                    const yearFilter = document.createElement("div");
                    const yearLabel = document.createElement("label");
                    yearLabel.textContent = "Select Years:";
                    yearFilter.appendChild(yearLabel);

                    const startYearSelect = document.createElement("select");
                    const endYearSelect = document.createElement("select");

                    years.forEach(year => {
                        const startOption = document.createElement("option");
                        const endOption = document.createElement("option");
                        startOption.value = endOption.value = year;
                        startOption.textContent = endOption.textContent = year;
                        startYearSelect.appendChild(startOption);
                        endYearSelect.appendChild(endOption);
                    });

                    startYearSelect.value = years[0];
                    endYearSelect.value = years[years.length - 1];

                    startYearSelect.addEventListener("change", () => {
                        const selectedItems = getSelectedItems();
                        updateTable(category, selectedItems, startYearSelect.value, endYearSelect.value);
                    });

                    endYearSelect.addEventListener("change", () => {
                        const selectedItems = getSelectedItems();
                        updateTable(category, selectedItems, startYearSelect.value, endYearSelect.value);
                    });

                    yearFilter.appendChild(startYearSelect);
                    yearFilter.appendChild(document.createTextNode(" ~ "));
                    yearFilter.appendChild(endYearSelect);
                    filters.appendChild(yearFilter);

                    // 항목 선택 필터
                    const itemFilter = document.createElement("div");
                    const itemLabel = document.createElement("label");
                    itemLabel.textContent = "Select Items:";
                    itemFilter.appendChild(itemLabel);

                    const checkboxGroup = document.createElement("div");

                    const items = [...categoryItems[category]];
                    items.forEach(item => {
                        const checkboxWrapper = document.createElement("label");
                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.value = item;
                        checkbox.checked = true; 

                        checkbox.addEventListener("change", () => {
                            const selectedItems = getSelectedItems();
                            updateTable(category, selectedItems, startYearSelect.value, endYearSelect.value);
                        });

                        checkboxWrapper.appendChild(checkbox);
                        checkboxWrapper.appendChild(document.createTextNode(item));
                        checkboxGroup.appendChild(checkboxWrapper);
                    });

                    itemFilter.appendChild(checkboxGroup);
                    filters.appendChild(itemFilter);
                }

                function getSelectedItems() {
                    return Array.from(filters.querySelectorAll("input[type='checkbox']:checked")).map(cb => cb.value);
                }
            })
            .catch(error => console.error("Error loading data:", error));
    </script>
</body>
</html>
