<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KoreaStatLinker - Main Statistics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters select {
            padding: 5px;
            font-size: 16px;
        }

        .statistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .statistics-table th,
        .statistics-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .statistics-table th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Main Statistics</h1>
        </div>

        <div class="filters">
            <div>
                <label for="start-year">Start Year:</label>
                <select id="start-year"></select>
            </div>
            <div>
                <label for="end-year">End Year:</label>
                <select id="end-year"></select>
            </div>
            <div>
                <label for="items">Items:</label>
                <select id="items" multiple size="3"></select>
            </div>
        </div>

        <table class="statistics-table">
            <thead>
                <tr id="table-header">
                    <th>Year</th>
                </tr>
            </thead>
            <tbody id="statistics-body">
            </tbody>
        </table>
    </div>

    <script>
        // Load data from JSON file
        fetch("population_data.json")
            .then(response => response.json())
            .then(data => {
                const years = Object.keys(data).sort((a, b) => b - a); // Sort years in descending order
                const startYearSelect = document.getElementById("start-year");
                const endYearSelect = document.getElementById("end-year");
                const itemsSelect = document.getElementById("items");
                const tableHeader = document.getElementById("table-header");
                const tableBody = document.getElementById("statistics-body");

                // Populate year dropdowns
                years.forEach(year => {
                    const option = document.createElement("option");
                    option.value = year;
                    option.textContent = year;
                    startYearSelect.appendChild(option.cloneNode(true));
                    endYearSelect.appendChild(option);
                });

                // Default to the last 10 years
                startYearSelect.value = years[Math.min(10, years.length) - 1];
                endYearSelect.value = years[0];

                // Get unique item names
                const itemNames = [...new Set(years.flatMap(year => Object.keys(data[year])))];

                // Populate items dropdown
                itemNames.forEach(name => {
                    const option = document.createElement("option");
                    option.value = name;
                    option.textContent = name;
                    itemsSelect.appendChild(option);
                });

                // Default to first 5 items
                for (let i = 0; i < Math.min(5, itemsSelect.options.length); i++) {
                    itemsSelect.options[i].selected = true;
                }

                // Update table based on selected filters
                function updateTable() {
                    const startYear = startYearSelect.value;
                    const endYear = endYearSelect.value;
                    const selectedItems = Array.from(itemsSelect.selectedOptions).map(opt => opt.value);

                    // Clear the table
                    tableHeader.innerHTML = "<th>Year</th>";
                    tableBody.innerHTML = "";

                    // Add selected items to table header
                    selectedItems.forEach(item => {
                        const th = document.createElement("th");
                        th.textContent = item;
                        tableHeader.appendChild(th);
                    });

                    // Add rows for each year in the selected range
                    years
                        .filter(year => year >= startYear && year <= endYear)
                        .forEach(year => {
                            const row = document.createElement("tr");
                            const yearCell = document.createElement("td");
                            yearCell.textContent = year;
                            row.appendChild(yearCell);

                            selectedItems.forEach(item => {
                                const cell = document.createElement("td");
                                cell.textContent = data[year][item] !== undefined ? data[year][item] : "-";
                                row.appendChild(cell);
                            });

                            tableBody.appendChild(row);
                        });
                }

                // Attach event listeners
                startYearSelect.addEventListener("change", updateTable);
                endYearSelect.addEventListener("change", updateTable);
                itemsSelect.addEventListener("change", updateTable);

                // Initialize table
                updateTable();
            })
            .catch(error => console.error("Error loading data:", error));
    </script>
</body>
</html>
