<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korea Indicator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters label {
            margin-right: 10px;
        }

        .filters select {
            padding: 5px;
            font-size: 16px;
            width: auto;
        }

        /* Custom Dropdown */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-button {
            padding: 8px 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
            cursor: pointer;
            user-select: none;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px; /* 너비 증가 */
            z-index: 1;
            max-height: 200px; /* 높이 제한 */
            overflow-y: auto; /* 스크롤 추가 */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .dropdown-content label {
            display: flex; /* 체크박스와 텍스트를 가로로 정렬 */
            align-items: center; /* 세로 가운데 정렬 */
            padding: 5px 10px;
            cursor: pointer;
            white-space: nowrap; /* 텍스트 줄바꿈 방지 */
            overflow: hidden;
            text-overflow: ellipsis; /* 넘치는 텍스트에 '...' 추가 */
        }

        .dropdown-content label:hover {
            background-color: #f1f1f1;
        }

        .dropdown-content input[type="checkbox"] {
            margin-right: 10px; /* 체크박스와 텍스트 간격 */
        }

        .dropdown.show .dropdown-content {
            display: block;
        }

        .statistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .statistics-table th,
        .statistics-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .statistics-table th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Korea Indicator</h1>
        </div>

        <div class="filters">
            <div>
                <label for="year-range">Year:</label>
                <select id="start-year"></select>
                <span>~</span>
                <select id="end-year"></select>
            </div>
            <div>
                <label for="items">Items:</label>
                <div class="dropdown" id="items-dropdown">
                    <div class="dropdown-button">Select Items</div>
                    <div class="dropdown-content" id="items-options"></div>
                </div>
            </div>
        </div>

        <table class="statistics-table">
            <thead>
                <tr id="table-header">
                    <th>Year</th>
                </tr>
            </thead>
            <tbody id="statistics-body">
            </tbody>
        </table>
    </div>

    <script>
        // Load data from JSON file
        fetch("population_data.json")
            .then(response => response.json())
            .then(data => {
                const years = Object.keys(data).sort((a, b) => b - a); // Sort years in descending order
                const startYearSelect = document.getElementById("start-year");
                const endYearSelect = document.getElementById("end-year");
                const itemsDropdown = document.getElementById("items-dropdown");
                const itemsOptions = document.getElementById("items-options");
                const tableHeader = document.getElementById("table-header");
                const tableBody = document.getElementById("statistics-body");

                // Populate year dropdowns
                years.forEach(year => {
                    const startOption = document.createElement("option");
                    const endOption = document.createElement("option");
                    startOption.value = endOption.value = year;
                    startOption.textContent = endOption.textContent = year;

                    startYearSelect.appendChild(startOption);
                    endYearSelect.appendChild(endOption);
                });

                // Default year range (last 10 years)
                const defaultStartYear = years[Math.min(10, years.length) - 1];
                const defaultEndYear = years[0];
                startYearSelect.value = defaultStartYear;
                endYearSelect.value = defaultEndYear;

                // Get unique item names
                const itemNames = [...new Set(years.flatMap(year => Object.keys(data[year])))];

                // Populate items dropdown
                itemNames.forEach(name => {
                    const label = document.createElement("label");
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.value = name;
                    checkbox.checked = itemsOptions.children.length < 5; // Default first 5 items selected

                    label.appendChild(checkbox);
                    label.append(name);
                    itemsOptions.appendChild(label);
                });

                // Toggle dropdown visibility
                itemsDropdown.querySelector(".dropdown-button").addEventListener("click", () => {
                    itemsDropdown.classList.toggle("show");
                });

                // Close dropdown if clicked outside
                window.addEventListener("click", (e) => {
                    if (!itemsDropdown.contains(e.target)) {
                        itemsDropdown.classList.remove("show");
                    }
                });

                // Add commas to numbers for better readability
                function formatNumber(number) {
                    return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                }

                // Get selected items from dropdown
                function getSelectedItems() {
                    return Array.from(itemsOptions.querySelectorAll("input[type='checkbox']:checked")).map(cb => cb.value);
                }

                // Update table based on selected filters
                function updateTable() {
                    const startYear = parseInt(startYearSelect.value);
                    const endYear = parseInt(endYearSelect.value);
                    const selectedItems = getSelectedItems();

                    // Clear the table
                    tableHeader.innerHTML = "<th>Year</th>";
                    tableBody.innerHTML = "";

                    // Add selected items to table header
                    selectedItems.forEach(item => {
                        const th = document.createElement("th");
                        th.textContent = item;
                        tableHeader.appendChild(th);
                    });

                    // Add rows for each year in the selected range
                    years
                        .filter(year => year >= startYear && year <= endYear)
                        .forEach(year => {
                            const row = document.createElement("tr");
                            const yearCell = document.createElement("td");
                            yearCell.textContent = year;
                            row.appendChild(yearCell);

                            selectedItems.forEach(item => {
                                const cell = document.createElement("td");
                                if (data[year][item] !== undefined) {
                                    cell.textContent = formatNumber(data[year][item]);
                                } else {
                                    cell.textContent = "-";
                                }
                                row.appendChild(cell);
                            });

                            tableBody.appendChild(row);
                        });
                }

                // Attach event listeners
                startYearSelect.addEventListener("change", updateTable);
                endYearSelect.addEventListener("change", updateTable);
                itemsOptions.addEventListener("change", updateTable);

                // Initialize table
                updateTable();
            })
            .catch(error => console.error("Error loading data:", error));
    </script>
</body>
</html>
