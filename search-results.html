<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .results-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .result-item {
            border-bottom: 1px solid #ddd;
            padding: 15px 0;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-item h3 {
            margin: 0 0 5px;
        }
        .result-item h3 a {
            color: #007BFF;
            text-decoration: none;
        }
        .result-item h3 a:hover {
            text-decoration: underline;
        }
        .result-item p {
            margin: 0;
            color: #555;
        }
    </style>
</head>
<body>
    <header>
        <h1>Search Results</h1>
        <p>Results for your query:</p>
    </header>

    <div class="results-container" id="results">
        <!-- 검색 결과가 동적으로 추가됩니다 -->
    </div>

    <footer>
        <p>Copyright © 2024 KoreaStatLinker. All rights reserved.</p>
    </footer>

    <script>
        // 검색어 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get("query").toLowerCase();

        // JSON 파일 경로
        const jsonFiles = {
            agencies: "agencies.json",
            news: "news_posts.json",
            resources: "statistics-resources.json"
        };

        // JSON 파일 읽기 및 처리
        async function fetchResults() {
            const resultsContainer = document.getElementById("results");
            let totalResults = 0;

            // 각 JSON 파일 처리
            for (const [key, file] of Object.entries(jsonFiles)) {
                const response = await fetch(file);
                const data = await response.json();

                // 검색 결과 필터링
                const results = data.filter(item => {
                    return Object.values(item).some(value => 
                        typeof value === "string" && value.toLowerCase().includes(query)
                    );
                });

                // 결과 표시
                if (results.length > 0) {
                    results.forEach(result => {
                        const div = document.createElement("div");
                        div.className = "result-item";

                        // 제목 또는 이름에 링크 걸기
                        const title = result.Name || result.title_en || result.name_en || "Untitled";
                        const link = result.link || "#";
                        const additionalInfo = result.category || result.date || result.category_en || "";

                        div.innerHTML = `
                            <h3><a href="${link}" target="_blank">${title}</a></h3>
                            <p>${additionalInfo}</p>
                        `;

                        resultsContainer.appendChild(div);
                        totalResults++;
                    });
                }
            }

            // 검색 결과가 없는 경우
            if (totalResults === 0) {
                resultsContainer.innerHTML = "<p>No results found.</p>";
            }
        }

        // 검색어 유효성 확인 후 처리
        if (query) {
            fetchResults();
        } else {
            document.getElementById("results").innerHTML = "<p>Please enter a search term.</p>";
        }
    </script>
</body>
</html>
